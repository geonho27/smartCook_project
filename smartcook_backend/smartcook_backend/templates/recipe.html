{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{{ recipe.title }} ë ˆì‹œí”¼</title>
  <link rel="stylesheet" href="{% static 'css/upload.css' %}">
</head>
<body class="upload">
  <div class="main-navbar">
    <!-- ì™¼ìª½ -->
    <div class="main-nav-left">
      <a href="{% url 'mainpage' %}" class="logo">SMARTCOOK</a>
    </div>
  
    <!-- ì˜¤ë¥¸ìª½ -->
    <div class="main-nav-right">
      <form method="POST" action="{% url 'logout' %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="logout-button">Logout</button>
      </form>
    </div>
  </div>
  
  
  <div class="recipe-container">
    <div class="recipe-content">
      <!-- ì™¼ìª½ ë°•ìŠ¤ -->
      <div class="recipe-left-box">
        <h2>ìƒì„¸ ë ˆì‹œí”¼</h2>
        <div class="recipe-subheading"><strong>ğŸ¥¢ {{ recipe.title }} ë ˆì‹œí”¼</strong></div>

        <p><strong>ì¬ë£Œ</strong></p>
        <ul>
          {% for ing in recipe.ingredients %}
            <li>{{ ing }}</li>
          {% endfor %}
        </ul>

        <p><strong>ë§Œë“œëŠ” ë²•</strong></p>
        <ol>
          {% for step in recipe.steps %}
            <li>{{ step }}</li>
          {% endfor %}
        </ol>
      </div>

      <!-- ì˜¤ë¥¸ìª½ ë°•ìŠ¤ -->
      <div class="recipe-right-box">
        <h2>ìœ íŠœë¸Œ ì˜ìƒ ë³´ëŸ¬ê°€ê¸°</h2>
        <div class="youtube-videos">
          {% for video in videos %}
            <div class="video-card">
              <a href="{{ video.url }}" target="_blank">
                <img src="{{ video.thumbnail }}" alt="{{ video.title }}">
                <p>{{ video.title }}</p>
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>


  <!-- ë²„íŠ¼ -->
  <div class="recipe-bottom-button">
    {% if mode == "detected" %}
      <button onclick="readRecipe()" class="tts-button" style="margin-right: 10px;" >ğŸ”Š ë ˆì‹œí”¼ ì½ì–´ì£¼ê¸°</button>
      <button onclick="location.href='{% url 'search_recipes_by_detected' %}?sort=match'">
        ë‹¤ë¥¸ ë ˆì‹œí”¼ ë³´ëŸ¬ê°€ê¸°
      </button>
    {% else %}
      <button onclick="readRecipe()" class="tts-button" style="margin-right: 10px;">ğŸ”Š ë ˆì‹œí”¼ ì½ì–´ì£¼ê¸°</button>
      <button onclick="location.href='{% url 'food_upload' %}?q={{ query }}'">
        ë‹¤ë¥¸ ë ˆì‹œí”¼ ë³´ëŸ¬ê°€ê¸°
      </button>
    {% endif %}
    
  </div>
  <div class="feedback-footer">
    Â© SmartCook. All rights reserved.
  </div>
  
</html>

<script>
  function readRecipe() {
    const title = "{{ recipe.title|escapejs }}";
    const ingredients = [{% for ing in recipe.ingredients %}"{{ ing|escapejs }}",{% endfor %}];
    const steps = [{% for step in recipe.steps %}"{{ step|escapejs }}",{% endfor %}];

    let text = `${title} ë ˆì‹œí”¼ì…ë‹ˆë‹¤. `;

    text += "ì¡°ë¦¬ ë°©ë²•ì€ ";
    steps.forEach((step, i) => {
      text += `${i + 1}ë‹¨ê³„, ${step}. `;
    });

    // âœ… ì„œë²„ì—ì„œ ë°›ì€ ì‚¬ìš©ì ëª©ì†Œë¦¬ (ì—†ìœ¼ë©´ ê¸°ë³¸)
    const voice = "{{ user.voice_name|default:'ko-KR-Standard-A' }}";

    const ttsUrl = `/tts/?text=${encodeURIComponent(text)}&voice=${encodeURIComponent(voice)}`;

    const audio = new Audio(ttsUrl);
    audio.play();
  }
</script>


